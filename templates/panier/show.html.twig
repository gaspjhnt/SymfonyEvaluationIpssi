{% extends 'base.html.twig' %}

{% block title %}Panier{% endblock %}

{% block body %}
    <div class="container mt-5">
        <h1 class="text-center mb-4">Mon Panier</h1>

        {# This Twig file is designed to display the detailed contents of a shopping cart. It presents the products included in the shopping cart with their details, and offers features for interacting with each product, as well as options for browsing or continuing shopping. #}
        {% if panier is not empty %}
            {% if is_granted('ROLE_ADMIN') %}
                <div class="text-center">
                    Panier de <a href="{{ path('app_user_show',{'id':panier.user.id}) }}">
                        {{ panier.user.nom ~ " " ~ panier.user.prenom }}
                    </a>
                    <hr>
                </div>
            {% endif %}
            <table class="table">
                <thead>
                <tr>
                    <th scope="col">Image</th>
                    <th scope="col">Nom</th>
                    <th scope="col">Prix</th>
                    <th scope="col">Description</th>
                    <th scope="col">Quantit√©</th>
                    <th scope="col">Date</th>
                    <th scope="col">Total</th>
                    <th scope="col">Actions</th>
                </tr>
                </thead>
                <tbody>
                {% set total = 0 %}
                {% for contenu in panier.contenuPaniers %}
                    <tr>
                        <td>
                            {% if contenu.produit.Photo is not null %}
                                <img src="{{ asset('uploads/images/' ~ contenu.produit.Photo) }}" style="width:100px;" alt="">
                            {% endif %}
                        </td>
                        <td>{{ contenu.produit.nom }}</td>
                        <td>{{ contenu.produit.prix }}‚Ç¨</td>
                        <td>{{ contenu.produit.description }}</td>
                        <td>{{ contenu.quantite }}</td>
                        <td>{{ contenu.date|date('d-m-Y') }}</td>
                        <td>{{ contenu.produit.prix * contenu.quantite }}‚Ç¨</td>
                        <td>
                            <a href="{{ path('app_panier_remove', {'id': contenu.produit.id}) }}" class="btn btn-dark">üóëÔ∏è</a>
                            <a href="{{ path('app_panier_removeLine', {'id': contenu.produit.id})  }}" class="btn btn-dark">‚ùå</a>
                            <a href="{{ path('app_produit_show', {'id': contenu.produit.id}) }}" class="btn btn-dark">üëÄ</a>
                        </td>
                    </tr>
                    {% set total = total + contenu.produit.prix * contenu.quantite %}
                {% endfor %}
                </tbody>
            </table>
            <div class="d-flex justify-content-evenly">
                <h5>Total √† payer </h5>
                <h5>{{ total }}‚Ç¨</h5>
            </div>
            {% if app.user == panier.user %}
                <div class="d-flex justify-content-center">
                    <a href="{{ path('app_panier_order', {'id': panier.id}) }}" class="btn btn-dark">Payer</a>
                </div>
            {% endif %}
        {% else %}
            <div class="d-flex flex-column">
                <div class="alert alert-info" role="alert">
                    Votre panier est vide !
                </div>
                <a href="{{ path('app_accueil') }}" class="btn btn-primary">Commencer vos achats</a>
            </div>
        {% endif %}

        {% if is_granted('ROLE_ADMIN') %}
            <a href="{{ path('app_panier_index') }}" class="btn btn-primary">Retour √† la liste des paniers</a>
        {% endif %}
    </div>
{% endblock %}
